# 最終確認テスト手順書

## テスト環境準備

### 1. データベースリフレッシュ

```bash
docker-compose exec php php artisan migrate:fresh --seed
```

### 2. テスト用ユーザー確認

-   **田中太郎** (tanaka@example.com) - 購入者
-   **佐藤花子** (sato@example.com) - 出品者
-   **山田次郎** (yamada@example.com) - 購入者

### 3. メール設定確認

-   Mailtrap 設定が有効になっていることを確認
-   `.env`ファイルのメール設定を確認

---

## Phase 1: 基本機能テスト

### US001: 取引チャット確認機能

#### FN001: 取引中商品確認機能

**テスト手順:**

1. 田中太郎でログイン
2. マイページにアクセス
3. 「取引中」タブをクリック
4. 取引中の商品が表示されることを確認
5. 各商品に新着メッセージ数が表示されることを確認

**期待結果:**

-   取引中の商品が一覧表示される
-   新着メッセージ数が正しく表示される

#### FN002: 取引チャット遷移機能

**テスト手順:**

1. マイページの取引中商品をクリック
2. 取引チャット画面に遷移することを確認

**期待結果:**

-   取引チャット画面が表示される
-   商品情報とメッセージ履歴が表示される

#### FN003: 別取引遷移機能

**テスト手順:**

1. 取引チャット画面のサイドバーを確認
2. 別の取引をクリック
3. 別の取引チャット画面に遷移することを確認

**期待結果:**

-   サイドバーに他の取引が表示される
-   別の取引に正常に遷移する

#### FN004: 取引自動ソート機能

**テスト手順:**

1. 複数の取引がある状態でマイページを確認
2. 新規メッセージが来た順に並んでいることを確認

**期待結果:**

-   最新のメッセージがある取引が上に表示される

#### FN005: 取引商品新規通知確認機能

**テスト手順:**

1. 新着メッセージがある商品を確認
2. 通知マーク（バッジ）が表示されることを確認
3. 通知マークにメッセージ数が表示されることを確認

**期待結果:**

-   新着メッセージがある商品に通知マークが表示される
-   通知マークに正しいメッセージ数が表示される

### US002: 取引評価平均確認機能

#### FN005: 評価平均確認機能

**テスト手順:**

1. 評価を受けているユーザーでログイン
2. プロフィール画面を確認
3. 評価平均が表示されることを確認
4. 評価がないユーザーでログイン
5. 評価が表示されないことを確認

**期待結果:**

-   評価があるユーザー：評価平均が四捨五入で表示される
-   評価がないユーザー：評価が表示されない

---

## Phase 2: チャット機能テスト

### US002: 取引チャット投稿機能

#### FN006: 取引チャット機能

**テスト手順:**

1. 取引チャット画面でメッセージを入力
2. 画像を添付（オプション）
3. 送信ボタンをクリック
4. メッセージが投稿されることを確認

**期待結果:**

-   メッセージが正常に投稿される
-   画像が添付される（添付した場合）

#### FN007: バリデーション

**テスト手順:**

1. 本文を空にして送信
2. 401 文字以上の本文で送信
3. .gif 形式の画像をアップロード
4. 各エラーメッセージが表示されることを確認

**期待結果:**

-   本文未入力：「本文を入力してください」
-   401 文字以上：「本文は 400 文字以内で入力してください」
-   不正な画像形式：「.png」または「.jpeg」形式でアップロードしてください

#### FN008: エラーメッセージ表示

**テスト手順:**

1. 上記のバリデーションエラーを発生させる
2. エラーメッセージが入力欄上部に表示されることを確認

**期待結果:**

-   エラーメッセージが適切な位置に表示される

#### FN009: 入力情報保持機能

**テスト手順:**

1. メッセージ入力欄に文字を入力
2. 他の画面に遷移
3. 取引チャット画面に戻る
4. 入力内容が保持されていることを確認

**期待結果:**

-   入力した本文が保持される（画像は保持されない）

---

## Phase 3: メッセージ編集・削除機能

### US003: メッセージ編集・削除機能

#### FN010: メッセージ編集機能

**テスト手順:**

1. 自分の投稿したメッセージの「編集」ボタンをクリック
2. メッセージを編集
3. 保存ボタンをクリック
4. メッセージが更新されることを確認

**期待結果:**

-   自分のメッセージのみ編集可能
-   メッセージが正常に更新される

#### FN011: メッセージ削除機能

**テスト手順:**

1. 自分の投稿したメッセージの「削除」ボタンをクリック
2. メッセージが削除されることを確認

**期待結果:**

-   自分のメッセージのみ削除可能
-   メッセージが正常に削除される

---

## Phase 4: 取引完了・評価機能

### US004: 取引完了・評価機能

#### FN012: 取引後評価機能（購入者）

**テスト手順:**

1. 購入者でログイン
2. 取引チャット画面で「取引完了」ボタンをクリック
3. 取引完了モーダルが表示されることを確認
4. 星評価を選択
5. 「送信する」ボタンをクリック
6. 評価が送信されることを確認

**期待結果:**

-   取引完了モーダルが表示される
-   評価が正常に送信される

#### FN013: 取引後評価機能（出品者）

**テスト手順:**

1. 出品者でログイン
2. 購入者が取引完了した取引チャット画面を開く
3. 取引完了モーダルが表示されることを確認
4. 星評価を選択
5. 「送信する」ボタンをクリック
6. 評価が送信されることを確認

**期待結果:**

-   取引完了モーダルが表示される
-   評価が正常に送信される

#### FN014: 取引後画面遷移

**テスト手順:**

1. 評価を送信
2. 商品一覧画面に遷移することを確認

**期待結果:**

-   評価送信後、商品一覧画面に遷移する

---

## Phase 5: メール送信機能

### US005: メール送信機能

#### FN015: メール送信

**テスト手順:**

1. 購入者が取引完了ボタンをクリック
2. 評価を送信
3. Mailtrap でメールが送信されることを確認

**期待結果:**

-   出品者宛に取引完了メールが送信される

#### FN016: メール送信機能

**テスト手順:**

1. 上記の手順を実行
2. Mailtrap のダッシュボードでメールを確認
3. メール内容が正しいことを確認

**期待結果:**

-   メールが正常に送信される
-   メール内容に取引詳細が含まれる

---

## テスト用データ準備

### GIF 形式画像ファイルの用意方法

1. オンラインで GIF 画像をダウンロード
2. または、画像編集ソフトで GIF 形式で保存
3. テスト用の小さな GIF ファイルを用意

### 長文テスト用データ

-   400 文字のテストメッセージを用意
-   401 文字のテストメッセージを用意

---

## エラー確認項目

### 文字数制限テスト

-   401 文字以上のメッセージ入力時のエラーメッセージ表示
-   長文送信時の画面外文字表示の修正

### 画像形式テスト

-   GIF 形式画像アップロード時のエラーメッセージ表示

### 取引後評価機能

-   取引中の商品から消えた場合の確認方法
-   評価済み商品の表示確認

---

## テスト実行時の注意点

1. **ブラウザキャッシュクリア**: テスト前にブラウザキャッシュをクリア
2. **セッション確認**: ログイン状態を適切に管理
3. **データベース状態**: テスト間でデータベース状態を確認
4. **メール設定**: Mailtrap の設定が有効であることを確認

---

## 完了確認項目

-   [ ] すべての機能が正常に動作する
-   [ ] エラーメッセージが適切に表示される
-   [ ] バリデーションが正しく機能する
-   [ ] メール送信が正常に動作する
-   [ ] UI/UX が適切に表示される
-   [ ] レスポンシブデザインが機能する
